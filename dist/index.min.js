!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.IQO=t()}(this,function(){"use strict";(function(e){var t,r,l,d,f,w,i;t=window,r=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,l=t.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),d=l&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),f=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,w=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,i=(l||f)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(e){var t,n,o,r,i,a,c,s,u;if(!(t=e.match(w)))throw new Error("invalid data URI");for(n=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),o=!!t[4],r=e.slice(t[0].length),i=o?atob(r):decodeURIComponent(r),a=new ArrayBuffer(i.length),c=new Uint8Array(a),s=0;s<i.length;s+=1)c[s]=i.charCodeAt(s);return l?new Blob([d?c:a],{type:n}):((u=new f).append(a),u.getBlob(n))},t.HTMLCanvasElement&&!r.toBlob&&(r.mozGetAsFile?r.toBlob=function(e,t,n){var o=this;setTimeout(function(){n&&r.toDataURL&&i?e(i(o.toDataURL(t,n))):e(o.mozGetAsFile("blob",t))})}:r.toDataURL&&i&&(r.toBlob=function(e,t,n){var o=this;setTimeout(function(){e(i(o.toDataURL(t,n)))})})),e.exports?e.exports=i:t.dataURLtoBlob=i})(e={exports:{}},e.exports);var e,n=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();return function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.prefix="[IQO]",this._URLCompat(),!isNaN(e)&&0<e?this.standard=e:this.standard=600}return n(t,[{key:"_URLCompat",value:function(){if(window.URL)this.URL=window.URL;else if(window.webkitURL)this.URL=window.webkitURL;else if(window.mozURL)this.URL=window.mozURL;else{if(!window.msURL)throw new Error(this.prefix+"`window.URL` is not support! please update your browser.");this.URL=window.msURL}}},{key:"_file2Image",value:function(o){var r=this;return new Promise(function(e,t){var n=void 0;r.image?n=r.image:((n=r.image=document.createElement("img")).style.display="none",document.body.append(n)),n.onload=function(){return e(n)},n.onerror=function(){return t(new Error(r.prefix+"image loading failed!"))},n.src=o,(n.complete||"undefined"===n.complete)&&(n.src="data:image/jpeg;base64,clean"+new Date,n.src=o)})}},{key:"_drawImage",value:function(a,c,s,u){var l=this;return new Promise(function(t,n){a.width<l.standard&&a.height<l.standard&&(u=1);var e=void 0,o=void 0;l.canvas?(e=l.canvas,o=l.ctx):(e=l.canvas=document.createElement("canvas"),o=l.ctx=e.getContext("2d"));var r=a.width*u/100,i=a.height*u/100;e.width=r,e.height=i;try{o.drawImage(a,0,0,a.width,a.height,0,0,r,i),e.toBlob(function(e){o.clearRect(0,0,r,i),t(e)},c,s/100)}catch(e){o.clearRect(0,0,r,i),n(e)}})}},{key:"compress",value:function(t,n,o){var r=this,i=t.type||"image/"+t.substr(t.lastIndexOf(".")+1);n=Number(n),(isNaN(n)||n<0||100<n)&&(n=95),o=Number(o),(isNaN(o)||o<0||100<o)&&(o=70);var a=this.URL.createObjectURL(t);return this._file2Image(a).then(function(e){return r._drawImage(e,i,n,o)}).then(function(e){return r.URL.revokeObjectURL(a),e.size<t.size?e:t}).catch(function(e){throw r.URL.revokeObjectURL(a),e})}}]),t}()});
