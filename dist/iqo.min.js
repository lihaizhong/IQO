!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.IQO=e()}(this,function(){"use strict";var t;(function(t){var e,r,d,f,l,w,i;e=window,r=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,d=e.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),f=d&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),l=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,w=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,i=(d||l)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(t){var e,n,o,r,i,a,s,c,u;if(!(e=t.match(w)))throw new Error("invalid data URI");for(n=e[2]?e[1]:"text/plain"+(e[3]||";charset=US-ASCII"),o=!!e[4],r=t.slice(e[0].length),i=o?atob(r):decodeURIComponent(r),a=new ArrayBuffer(i.length),s=new Uint8Array(a),c=0;c<i.length;c+=1)s[c]=i.charCodeAt(c);return d?new Blob([f?s:a],{type:n}):((u=new l).append(a),u.getBlob(n))},e.HTMLCanvasElement&&!r.toBlob&&(r.mozGetAsFile?r.toBlob=function(t,e,n){var o=this;setTimeout(function(){n&&r.toDataURL&&i?t(i(o.toDataURL(e,n))):t(o.mozGetAsFile("blob",e))})}:r.toDataURL&&i&&(r.toBlob=function(t,e,n){var o=this;setTimeout(function(){t(i(o.toDataURL(e,n)))})})),t.exports?t.exports=i:e.dataURLtoBlob=i})(t={exports:{}},t.exports);function e(t){this.prefix="[IQO]",this.standard=!isNaN(t)&&0<t?t:600,this._URLCompat()}var n=e.prototype={};return n._URLCompat=function(){if(window.URL)this.URL=window.URL;else if(window.webkitURL)this.URL=window.webkitURL;else if(window.mozURL)this.URL=window.mozURL;else{if(!window.msURL)throw new Error(this.prefix+"`window.URL` is not support! please update your browser.");this.URL=window.msURL}},n._file2Image=function(o){var r=this;return new Promise(function(t,e){var n=new Image;n.onload=function(){return t(n)},n.onerror=function(){return e(new Error(r.prefix+"image loading failed!"))},n.src=o,(n.complete||"undefined"===n.complete)&&(n.src="data:image/jpeg;base64,clean"+new Date,n.src=o)})},n._drawImage=function(a,s,c,u){var d=this;return new Promise(function(e,n){a.width<d.standard&&a.height<d.standard?u=1:u/=100,d.canvas||(d.canvas=document.createElement("canvas"),d.ctx=d.canvas.getContext("2d"));var t=d.canvas,o=d.ctx,r=a.width*u,i=a.height*u;t.width=r,t.height=i;try{o.clearRect(0,0,r,i),o.drawImage(a,0,0,a.width,a.height,0,0,r,i),t.toBlob(function(t){return e(t)},s,c/100)}catch(t){n(t)}})},e.prototype.compress=function(e,n,o){var r=this,i=e.type||"image/"+e.substr(e.lastIndexOf(".")+1);n=Number(n),(isNaN(n)||n<0||100<n)&&(n=95),o=Number(o),(isNaN(o)||o<0||100<o)&&(o=70);var a=this.URL.createObjectURL(e);return this._file2Image(a).then(function(t){return r._drawImage(t,i,n,o)}).then(function(t){return r.URL.revokeObjectURL(a),t.size<e.size?t:e}).catch(function(t){throw r.URL.revokeObjectURL(a),t})},e});
